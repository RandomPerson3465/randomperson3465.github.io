String.prototype.hexEncode=function(){let e,t="";for(i=0;i<this.length;i++)t+=("000"+(e=this.charCodeAt(i).toString(16))).slice(-4);return t},String.prototype.hexDecode=function(){let e=this.match(/.{1,4}/g)||[],t="";for(i=0;i<e.length;i++)t+=String.fromCharCode(parseInt(e[i],16));return t};const L={DEBUG_MODE:"true"!=localStorage.getItem("debugMode"),debug(e){L.DEBUG_MODE&&console.log(`[Debug] ${e}`)},info(e){console.log(`[Info] ${e}`)},warn(e){console.warn(`[Debug] ${e}`)},INT32_LIMIT:2147483647,CURRENT_VERSION:2,MIN_INTERVAL:10,MIN_GRAPH_INTERVAL:50,FONTS:[{value:"Arial",name:"Arial"},{value:"Bebas Neue",name:"Bebas Neue"},{value:"Lato",name:"Lato"},{value:"Montserrat",name:"Montserrat"},{value:"Open Sans",name:"Open Sans"},{value:"Roboto",name:"Roboto"},{value:"Roboto Mono",name:"Roboto Mono"},{value:"Roboto Slab",name:"Roboto Slab"},{value:"Ubuntu",name:"Ubuntu"},{value:"sans-serif",name:"Sans Serif"},{value:"serif",name:"Serif"}],workspace:document.querySelector(".workspace"),quickSelectButton:document.querySelector("#quickSelect"),selectMenu:document.querySelector("#objectSelect"),newObjectSelect:document.querySelector("#newObjectSelect"),objectMenu:document.querySelector("#objectMenu"),controlMenu:document.querySelector("#objectControls"),fileImport:document.querySelector("#fileImport"),top50Import:document.querySelector("#top50Import"),ytsImport:document.querySelector("#ytsImport"),bgColorSelect:document.querySelector("#bgColorSelect"),bgColor:"#d3d3d3",menuObjects:{CustomCounter:"Counter",CompareCounter:"Compare",EditableText:"Text",Image:"Image",Rectangle:"Rectangle",Row:"Row",Column:"Column",Box:"Box",LiveGraph:"Live Graph",StaticGraph:"Static Graph",Channel:"Channel"},objectList:[],toggleDebug(){if(L.newObjectSelect.replaceChildren([]),L.DEBUG_MODE){for(i=0,L.DEBUG_MODE=!1;i<Object.keys(L.menuObjects).length;i++){let e=document.createElement("option");e.setAttribute("value",Object.keys(L.menuObjects)[i]),e.innerText=L.menuObjects[Object.keys(L.menuObjects)[i]],L.newObjectSelect.appendChild(e)}document.querySelector("#lcedit-title").innerText="Lcedit BETA 3";let t=document.querySelector("#debug-style");t&&t.remove(),L.info("Debug mode disabled.")}else{L.DEBUG_MODE=!0;let r=Object.keys(C).sort();for(i=0;i<r.length;i++){let s=document.createElement("option");s.setAttribute("value",r[i]),s.innerText=r[i],L.newObjectSelect.appendChild(s)}document.querySelector("#lcedit-title").innerText="Lcedit BETA 3 Debug Mode";let a=document.querySelector("#debug-style");a||((a=document.createElement("style")).id="debug-style",a.innerText=".lcedit-object { border: 1px dashed red; }",document.head.appendChild(a)),L.info("Debug mode enabled.")}},clamp:(e,t=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER)=>(isNaN(e)&&(e=0),e<t)?t:e>r?r:e,abb(e){let t=Math.sign(e);return(e=Math.abs(e))<1?0:t*Math.floor(e/10**(Math.floor(Math.log10(e))-2))*10**(Math.floor(Math.log10(e))-2)},random:(e=0,t=1)=>parseFloat(e)+Math.random()*(parseFloat(t)-parseFloat(e))||0,randomGaussian(e,t){let r=0,s=0;for(;!r;)r=Math.random();for(;!s;)s=Math.random();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*s)*parseFloat(t)+parseFloat(e)},randomFromCustomDistribution(e){if("object"!=typeof e||!e.entries||!e.entries.length||!e.totalWeight||e.totalWeight<0)return 0;let t=Math.random()*e.totalWeight,r=0;for(;t>e.entries[r]?.cutoff&&e.entries[r];)r++;return L.random(e.entries[r].min,e.entries[r].max)},createCustomDistribution(e){let t={totalWeight:0,entries:[]},r=0,s=e.split("\n");for(i=0;i<s.length;i++){let a=s[i].split(",");r+=parseFloat(a[2])||0;let o={min:parseFloat(a[0])||0,max:parseFloat(a[1])||0,cutoff:r};t.entries.push(o),t.totalWeight=r}return t},updateMenu(e){let t=L.objectMenu.querySelectorAll("input,textarea,select"),r=e.menus[Object.keys(e.menus)[e.currentPage]].filter(e=>"table"!==e.type&&"info"!==e.type);for(i=0;i<t.length;i++)"file"!==r[i].type&&("checkbox"===r[i].type?t[i].checked=e.properties[r[i].id]:t[i].value=e.properties[r[i].id],r[i].condition&&(e.properties[r[i].condition]!==r[i].conditionalValue?(t[i].parentElement.style.display="none",t[i].parentElement.nextElementSibling.style.display="none"):(t[i].parentElement.style.display="inline",t[i].parentElement.nextElementSibling.style.display="inline")));L.debug("Menu updated.")},getAllChannels(e){let t=[{value:"",name:"Select a counter"}];for(let r of L.objectList)r instanceof C.Counter&&r.properties.name!==e&&t.push({value:r.properties.name,name:r.properties.name});return t},getObjectByName:e=>L.objectList.filter(t=>t.properties.name===e)[0],getContainableObjects(e){let t=L.getObjectByName(e);return t instanceof C.Box?[{value:"",name:"Select an object"}].concat(L.objectList.filter(t=>t.properties.name!==e).map(e=>({value:e.properties.name,name:e.properties.name}))):[{value:"",name:"Select an object"}].concat(L.objectList.filter(e=>!(e instanceof C.Container)).map(e=>({value:e.properties.name,name:e.properties.name})))},toggleMenu(){let e=document.querySelector(".menu");"block"==e.style.display?e.style.display="none":e.style.display="block"},getObjectByElementId(e){if(e&&e.startsWith("lcedit-"))return L.getObjectByName(e.replace("lcedit-","").hexDecode())},deleteCurrentObject(){if(confirm("Are you sure you want to delete this object?")){document.querySelector(".paginator").style.display="none",L.controlMenu.replaceChildren([]),L.objectMenu.replaceChildren([]);let e=L.getObjectByName(L.selectMenu.value);if(e){if(e.updater&&clearInterval(e.updater),e instanceof C.Counter){let t=L.objectList.filter(e=>e instanceof C.CompareCounter);for(i=0;i<t.length;i++)t[i].properties.counterA===e.properties.name&&(t[i].properties.counterA=""),t[i].properties.counterB===e.properties.name&&(t[i].properties.counterB="")}if(e instanceof C.Container)for(i=0;i<L.objectList.length;i++)L.objectList[i].properties.container===e.properties.name&&(L.objectList[i].properties.container="",L.objectList[i].properties.attachmentOrder=-1,L.objectList[i].attach());e instanceof C.Graph&&e.chart&&e.chart.destroy(),e.deleted=!0,e.HTMLElement.remove(),L.debug(`Deleted object ${e.properties.name}`)}L.objectList=L.objectList.filter(e=>e.properties.name!==L.selectMenu.value);let r=document.querySelector(`#style-${e.properties.name.hexEncode()}`);r&&r.remove(),L.generateSelect()}},generateControls(e){if(e)for(L.controlMenu.replaceChildren([]),i=0;i<e.controls.length;i++){let t=e.controls[i];t.id&&(t.state=e.properties[t.id]?1:0);let r=document.createElement("button");r.className="control",r.setAttribute("title",t.titles[t.state]),t.state===t.activeState?r.className+=" active":r.className=r.className.replace(" active","");let s=document.createElement("span");s.className="material-symbols-outlined",s.innerText=t.states[t.state],r.appendChild(s),L.controlMenu.appendChild(r),r.addEventListener("click",()=>{t.state=Math.min(t.state+1,(t.state+1)%t.states.length),t.state===t.activeState?r.className+=" active":r.className=r.className.replace(" active",""),t.id&&(e.properties[t.id]=!!t.state),t.function&&t.function(t.state),r.setAttribute("title",t.titles[t.state]),s.innerText=t.states[t.state],e.update()})}},generateMenu(e){if(!e)return;L.updatePage(e),L.generateControls(e),L.objectMenu.replaceChildren([]);let t=e.menus[Object.keys(e.menus)[e.currentPage]];for(let r of t){let s,a,o,n,p=document.createElement("span");switch(r.labelLeft&&(p.innerHTML+=r.labelLeft+" "),r.type){case"textbox":s=document.createElement("textarea");break;case"select-add":for(let l of(s=document.createElement("select"),(a=document.createElement("button")).innerText=r.labelButton,a.onclick=()=>{r.buttonFunction(s.value)},r.optionsFunction&&(r.options=r.optionsFunction(e.properties.name)),r.options)){let h=document.createElement("option");h.value=l.value,h.innerText=l.name,s.appendChild(h)}break;case"select-number":case"select":for(let d of(s=document.createElement("select"),r.optionsFunction&&(r.options=r.optionsFunction(e.properties.name)),r.options)){let c=document.createElement("option");c.value=d.value,c.innerText=d.name,s.appendChild(c)}break;case"table":o=document.createElement("table");let u=r.tableData();for(i=0;i<u.length;i++){let m=u[i],g=document.createElement("tr"),b=document.createElement("td");b.innerText=m;let y=document.createElement("td"),$=document.createElement("button");$.innerText="X",$.onclick=()=>{r.tableFunction(m)},y.appendChild($),g.appendChild(b),g.appendChild(y),o.appendChild(g)}break;case"info":(n=document.createElement("p")).innerText=r.info;break;default:s=document.createElement("input")}if("value"===r.id&&(s.className="count-input"),s&&(s.setAttribute("type",r.type),r.placeholder&&s.setAttribute("placeholder",r.placeholder),"file"===r.type&&s.setAttribute("accept","image/png, image/jpeg"),s.addEventListener("input",t=>{if("number"===r.type||"select-number"===r.type){let s=Number(t.target.value)||0;e.properties[r.id]=s,e.properties.lockAspectRatio&&("width"===r.id&&(e.properties.height=s/e.aspectRatio),"height"===r.id&&(e.properties.width=s*e.aspectRatio,e instanceof C.Text&&(e.properties.fontSize=Math.round(e.textRatio*s),e.properties.padding=Math.round(e.paddingRatio*s))))}else"checkbox"===r.type?e.properties[r.id]=t.target.checked:"file"===r.type?e.properties[r.id]=t.target.files:r.id&&(e.properties[r.id]=t.target.value);e.update(),r.updateMenu&&L.updateMenu(e)}),p.appendChild(s)),r.labelRight){let f=document.createElement("span");f.innerText=" "+r.labelRight,p.appendChild(f)}a&&p.appendChild(a),n&&L.objectMenu.appendChild(n),o&&L.objectMenu.appendChild(o),p.children.length&&L.objectMenu.appendChild(p),L.objectMenu.appendChild(document.createElement("br"))}L.updateMenu(e)},updatePage(e){let t=e.currentPage,r=Object.keys(e.menus)[t],s=Object.keys(e.menus).length-1;document.querySelector(".paginator").style.display="flex",0===t?document.querySelector("#prevPage").style.visibility="hidden":document.querySelector("#prevPage").style.visibility="visible",t===s?document.querySelector("#nextPage").style.visibility="hidden":document.querySelector("#nextPage").style.visibility="visible",document.querySelector("#pageName").innerText=r},prevPage(){let e=L.getObjectByName(L.selectMenu.value);e&&(e.currentPage=Math.max(0,e.currentPage-1),L.updatePage(e),L.generateMenu(e))},nextPage(){let e=L.getObjectByName(L.selectMenu.value);e&&(e.currentPage=Math.min(Object.keys(e.menus).length-1,e.currentPage+1),L.updatePage(e),L.generateMenu(e))},generateSelect(e){let t=L.selectMenu.value;for(let r of(L.selectMenu.replaceChildren([]),L.objectList)){let s=document.createElement("option");s.innerText=r.properties.name,s.value=r.properties.name,L.selectMenu.appendChild(s)}L.selectMenu.value=e||t,e&&L.getObjectByName(e)&&L.generateMenu(L.getObjectByName(e))},dragElement(e){let t=0,r=0,s=0,a=0,o=L.getObjectByElementId(e.id)||{},n=1;function p(p){if(o.properties.container){let l=L.getObjectByName(o.properties.container);l instanceof C.Box&&(n=l.properties.scale/100)}(p=p||window.event).preventDefault(),t=s-p.clientX,r=a-p.clientY,s=p.clientX,a=p.clientY,o.properties.x=e.offsetLeft-t/n,o.properties.y=e.offsetTop-r/n,o.center(),L.selectMenu.value===o.properties.name&&L.updateMenu(o),e.style.top=o.properties.y+"px",e.style.left=o.properties.x+"px"}function l(){document.onmouseup=null,document.onmousemove=null}o.dragBox&&(o.dragBox.onmousedown=function e(t){o.properties.draggable&&((t=t||window.event).preventDefault(),s=t.clientX,a=t.clientY,document.onmouseup=l,document.onmousemove=p)})},updateDimensions(e){let t=e[0].target,r=L.getObjectByElementId(t.id);r&&(r.properties.lockAspectRatio&&r.resizeWidth&&r.resizeHeight?r.aspectRatio<1?(r.properties.width=parseInt(t.style.width),r.properties.height=parseInt(t.style.width)/r.aspectRatio):(r.properties.width=parseInt(t.style.height)*r.aspectRatio,r.properties.height=parseInt(t.style.height)):(r.resizeWidth&&(r.properties.width=parseInt(t.style.width)),r.resizeHeight&&(r.properties.height=parseInt(t.style.height))),r instanceof C.Text&&r.properties.scaleText&&r.properties.height>0&&(r.properties.fontSize=Math.round(r.textRatio*r.properties.height),r.properties.padding=Math.round(r.paddingRatio*r.properties.height)),r.update(),L.selectMenu.value===r.properties.name&&L.updateMenu(r))},createObjectFromType:(e,t)=>C[e]?new C[e](t):null,configureNewObject(e,t){if(e){if(t)for(i=0;i<Object.keys(t).length;i++){let r=Object.keys(t)[i];"name"!==r&&("number"==typeof e.properties[r]&&isNaN(t[r])&&(t[r]=0),e.properties[r]=t[r])}e.instantiate(),L.objectList.push(e),L.dragElement(e.HTMLElement),new ResizeObserver(L.updateDimensions).observe(e.HTMLElement)}},createNewObject(){let e=document.querySelector("#objectName").value,t=document.querySelector(".warning-text");if(e=e.trim()){if(L.getObjectByName(e))t.innerText="An object already exists with that name.",t.style.display="block";else{t.style.display="none";let r=L.createObjectFromType(L.newObjectSelect.value,e);r&&(L.configureNewObject(r),r.attach(),L.generateSelect(e),Odometer.init())}}else t.innerText="Please enter a name.",t.style.display="block";document.querySelector("#objectName").value=""},objectSelected(e){if(e.target){let t=e.target,r;do r=L.getObjectByElementId(t.id),t=t.parentElement;while(!r&&t);r&&(L.selectMenu.value=r.properties.name,L.generateMenu(r)),L.quickSelectButton.className=""}},quickSelect(){"quickSelectActive"===L.quickSelectButton.className?(L.quickSelectButton.className="",L.workspace.removeEventListener("click",L.objectSelected,{once:!0})):(L.quickSelectButton.className="quickSelectActive",L.workspace.addEventListener("click",L.objectSelected,{once:!0}))},generateJSON(){let e=L.objectList.map(e=>e.properties);return JSON.stringify({data:e,version:L.CURRENT_VERSION,createdAt:Date.now(),bgColor:L.bgColor})},exportAsJSON(){let e=document.createElement("a"),t=new Blob([L.generateJSON()],{type:"text/json"});e.href=URL.createObjectURL(t),e.download="export.json",e.click()},clearWorkspace(){L.objectList.filter(e=>e.updater).forEach(e=>clearInterval(e.updater)),L.objectList=[],L.workspace.replaceChildren([]),L.objectMenu.replaceChildren([]),L.controlMenu.replaceChildren([]),document.querySelector(".paginator").style.display="none";let e=document.querySelectorAll("style");for(i=0;i<e.length;i++)e[i].remove();L.generateSelect(""),L.debug("Reset workspace.")},importFromJSON(e,t=!1){L.fileImport.value="";let r=!1;if(t&&(r=confirm("Are you sure? This will overwrite your current data.")),!t||r){if(L.clearWorkspace(),"string"==typeof e)try{e=JSON.parse(e)}catch(s){return alert("There was an error loading your file.")}if(!e||!e.data)return alert("There was an error loading your file.");if(e.version>L.CURRENT_VERSION)return alert("Incompatible version");for(let a of e.data){let o=L.createObjectFromType(a.type,a.name);o&&L.configureNewObject(o,a)}for(L.generateSelect(),i=0;i<L.objectList.length;i++){let n=L.objectList[i];L.getObjectByName(n.properties.container)||n.attach()}let p=L.objectList.filter(e=>e instanceof C.Container);for(i=0;i<p.length;i++){let l=p[i].getChildren();for(j=0;j<l.length;j++)L.getObjectByName(l[j]).attach()}e.bgColor&&(L.bgColor=e.bgColor,L.bgColorSelect.value=e.bgColor,document.body.style.backgroundColor=e.bgColor),Odometer.init()}},importFromTop50(e){if(confirm("Are you sure? This will overwrite your current data. It will only import the counters, not the top 50 layout."))try{e=JSON.parse(e);let t=[];for(i=0;i<e.data.length;i++)t.push({type:"Channel",name:`Channel ${i+1}`,title:e.data[i].name||"",value:e.data[i].count||0,abbreviated:e.abbreviate||!1,showTitle:e.showNames||!1,showImage:e.showImages||!1,bgColor:e.bgColor,upColor:e.odometerUp,downColor:e.odometerDown,gainType:null==e.data[i].std_gain?0:1,minRate:e.data[i].min_gain||0,maxRate:e.data[i].max_gain||0,stdevRate:e.data[i].std_gain||0,meanRate:e.data[i].mean_gain||0,imageURL:e.data[i].image,textColor:e.textColor,updateInterval:e.updateInterval/1e3||2,odoTime:e.odometerSpeed,min:e.allowNegative?Number.MIN_SAFE_INTEGER:0,updateColors:!0});L.importFromJSON({data:t})}catch(r){return alert("There was an error loading your file.")}},importFromYTStudio(e){if(confirm("Are you sure? This will overwrite your current data. It will only import the counter and graph, not the YT studio layout."))try{e=JSON.parse(e),L.importFromJSON({data:[{type:"Channel",name:"Channel",title:e.name,value:e.count,abbreviated:!1,minRate:e.min_gain,maxRate:e.max_gain,updateInterval:e.updateInterval/1e3||2,showGraph:"live"==e.graphType,imageURL:e.image}]})}catch(t){return alert("There was an error loading your file.")}},confirmReset(){confirm("Are you sure you want to reset EVERYTHING? This CANNOT be undone unless you have a backup saved!")&&L.clearWorkspace()},saveInBrowser(){localStorage.setItem("lcbeta",L.generateJSON()),localStorage.setItem("debugMode",L.DEBUG_MODE.toString()),L.debug("Saved in browser.")}},C={};C.Base=class e{constructor(e,t){this.properties={type:"Base",x:0,y:30,width:100,height:100,draggable:!1,resizable:!1,lockAspectRatio:!1,centerx:!1,centery:!1,visible:!0,opacity:100,layer:0,name:e,round:!1,container:"",attachmentOrder:0},this.deleted=!1,this.HTMLElement=t,this.dragBox=null,this.aspectRatio=0===this.properties.height?1:this.properties.width/this.properties.height,this.currentPage=0,this.resizeWidth=!0,this.resizeHeight=!0,this.controls=[{states:["delete"],titles:["Delete"],state:0,activeState:-1,function(){L.deleteCurrentObject()}},{states:["content_copy"],titles:["Duplicate"],state:0,activeState:-1,title:"Duplicate",function:()=>{let e=prompt("Name of copy:");if(e){if(L.getObjectByName(e))return alert("An object already exists with that name.");this.copy(e),L.generateSelect(e),alert("Object successfully duplicated")}}},{id:"visible",titles:["Show object","Hide object"],states:["visibility","visibility_off"],state:0,activeState:-1}],this.menus={"Positioning and Size":[{id:"x",labelLeft:"X",labelRight:"px",type:"number"},{id:"y",labelLeft:"Y",labelRight:"px",type:"number"},{id:"width",labelLeft:"Width",labelRight:"px",type:"number"},{id:"height",labelLeft:"Height",labelRight:"px",type:"number"},{id:"layer",labelLeft:"Layer",type:"number"}],Styles:[{id:"opacity",labelLeft:"Opacity",labelRight:"%",type:"number"},]},this.styleMappings={x:"left",y:"top",width:"width",height:"height",visible:"visibility",opacity:"opacity",layer:"z-index",round:"border-radius"},this.styleModifiers={opacity:.01,visibility:["visible","hidden"],cursor:["move","default"],"border-radius":["50%","0%"]}}attach(){if(this.HTMLElement){let e;if(e=L.getObjectByName(this.properties.container)){let t=e.HTMLElement?.querySelector(".lcedit-container");if(t){if(-1===this.properties.attachmentOrder){let r=e.getChildren();r.length?this.properties.attachmentOrder=(L.getObjectByName(r[r.length-1])?.properties.attachmentOrder||0)+1:this.properties.attachmentOrder=1,L.debug(`Attaching object ${this.properties.name} to container ${this.properties.container}, Container has ${r.length} children, Attachment order ${this.properties.attachmentOrder}`)}t.appendChild(this.HTMLElement)}}else this.properties.attachmentOrder=-1,L.workspace.appendChild(this.HTMLElement),L.debug(`Detaching object ${this.properties.name}`)}}center(){this.HTMLElement&&(this.properties.centerx&&(this.properties.x=(window.innerWidth-this.HTMLElement.clientWidth)/2,L.debug(`Centered object ${this.properties.name} horizontally`)),this.properties.centery&&(this.properties.y=(window.innerHeight-this.HTMLElement.clientHeight)/2,L.debug(`Centered object ${this.properties.name} vertically`)))}copy(e=this.properties.name){for(;L.getObjectByName(e);)e+=" Copy";L.debug(`Copying object ${this.properties.name} to ${e}`);let t=L.createObjectFromType(this.properties.type,e);return t&&(L.configureNewObject(t,this.properties),t.attach(),Odometer.init()),t}resizeAspectRatio(){this.properties.height>0&&!this.properties.lockAspectRatio&&(this.aspectRatio=this.properties.width/this.properties.height,L.debug(`Setting aspect ratio of object ${this.properties.name} to ${this.aspectRatio} (${this.properties.width} / ${this.properties.height})`)),this.properties.resizable?this.properties.lockAspectRatio?this.aspectRatio<1?this.HTMLElement.style.resize="horizontal":this.HTMLElement.style.resize="vertical":this.HTMLElement.style.resize="both":this.HTMLElement.style.resize="none"}updateStyles(){if(!this.deleted){for(let e of(this.dragBox&&(this.resizeWidth&&(this.dragBox.style.width=this.properties.width),this.resizeHeight&&(this.dragBox.style.height=this.properties.resizable?this.properties.height-10:this.properties.height),this.properties.draggable?(this.dragBox.style.display="block",this.dragBox.style.cursor="move"):this.dragBox.style.display="none"),this.center(),Object.keys(this.styleMappings))){let t=this.styleMappings[e],r=this.properties[e];this.styleModifiers[t]&&("number"==typeof this.styleModifiers[t]&&(r*=this.styleModifiers[t]),this.styleModifiers[t]instanceof Array&&(r=r?this.styleModifiers[t][0]:this.styleModifiers[t][1])),this.HTMLElement.style[t]=r}this.resizeAspectRatio()}}instantiateBase(){L.debug(`Instantiating object ${this.properties.name}`);let e=document.createElement("div");e.className="lcedit-object",e.id="lcedit-"+this.properties.name.hexEncode();let t=document.createElement("div");t.style.width=this.properties.width,t.style.height=this.properties.height-10,t.className="dragbox",t.style.zIndex=2,e.appendChild(t),this.dragBox=t,this.HTMLElement=e}update(){this.deleted||this.updateStyles()}instantiate(){this.instantiateBase(),this.update()}},C.Container=class e extends C.Base{constructor(e,t){super(e,t),this.properties.type="Container",this.properties.borderColor="#000000",this.properties.borderWidth=1,this.containerType="container",this.controls=this.controls.concat([{id:"draggable",states:["drag_pan","drag_pan"],titles:["Enable dragging","Disable dragging"],state:0,activeState:1},{id:"resizable",states:["resize","resize"],titles:["Enable resizing","Disable resizing"],state:0,activeState:1},{id:"centerx",states:["align_horizontal_center","align_horizontal_center"],titles:["Horizontally center object","Horizontally uncenter object"],state:0,activeState:1},{id:"centery",states:["align_vertical_center","align_vertical_center"],titles:["Vertically center object","Vertically uncenter object"],state:0,activeState:1},]),this.getChildren=()=>L.objectList.filter(e=>e.properties.container===this.properties.name).sort((e,t)=>e.properties.attachmentOrder-t.properties.attachmentOrder).map(e=>e.properties.name),this.copy=(e=this.properties.name)=>{for(;L.getObjectByName(e);)e+=" Copy";let t=L.createObjectFromType(this.properties.type,e);return t&&(L.configureNewObject(t,this.properties),t.attach()),this.getChildren().map(e=>L.getObjectByName(e)).forEach(t=>{let r=t.copy();r.properties.container=e,r.attach()}),t},this.menus={"Positioning and Size":[],Styles:[{id:"borderColor",labelLeft:"Border Color",type:"color"},{id:"borderWidth",labelLeft:"Border Width",labelRight:"px",type:"number"}],Objects:[{type:"table",tableData:this.getChildren,tableFunction:e=>{let t=L.getObjectByName(e);t&&(t.properties.container="",t.attach()),L.generateMenu(this)}},{type:"select-add",options:L.getContainableObjects(this.properties.name),optionsFunction:L.getContainableObjects,labelButton:"Add",buttonFunction:e=>{let t=L.getObjectByName(e);t&&(t.properties.container=this.properties.name,t.attach()),L.generateMenu(this)}}]},this.styleMappings={x:"left",y:"top",visible:"visibility",layer:"z-index",borderColor:"border-color",borderWidth:"border-width"},this.styleModifiers={},this.resizeAspectRatio=()=>{},this.instantiate=()=>{this.instantiateBase();let e=document.createElement("div");e.className=`lcedit-container lcedit-${this.containerType}`,e.style.zIndex=0,this.HTMLElement.appendChild(e),this.HTMLElement.style.borderStyle="solid",this.update()}}},C.Row=class e extends C.Container{constructor(e,t){super(e,t),this.properties.type="Row",this.properties.resizable=!0,this.properties.draggable=!0,this.properties.centerx=!0,this.containerType="row",this.resizeWidth=!1,this.menus["Positioning and Size"]=[{id:"x",labelLeft:"X",labelRight:"px",type:"number"},{id:"y",labelLeft:"Y",labelRight:"px",type:"number"},{id:"width",labelLeft:"Width",labelRight:"%",type:"number"},{id:"height",labelLeft:"Height",labelRight:"px",type:"number"},{id:"layer",labelLeft:"Layer",type:"number"}],this.styleMappings.height="height",this.styleMappings.resizable="resize",this.styleModifiers={resize:["vertical","none"]},this.update=()=>{this.deleted||(this.updateStyles(),this.HTMLElement.style.width=this.properties.width+"vw",this.dragBox.style.width=this.properties.width+"vw")}}},C.Column=class e extends C.Container{constructor(e,t){super(e,t),this.properties.type="Column",this.properties.resizable=!0,this.properties.draggable=!0,this.properties.centery=!0,this.containerType="column",this.resizeHeight=!1,this.menus["Positioning and Size"]=[{id:"x",labelLeft:"X",labelRight:"px",type:"number"},{id:"y",labelLeft:"Y",labelRight:"px",type:"number"},{id:"width",labelLeft:"Width",labelRight:"px",type:"number"},{id:"height",labelLeft:"Height",labelRight:"%",type:"number"},{id:"layer",labelLeft:"Layer",type:"number"}],this.styleMappings.width="width",this.styleMappings.resizable="resize",this.styleModifiers={resize:["horizontal","none"]},this.update=()=>{this.deleted||(this.updateStyles(),this.HTMLElement.style.height=this.properties.height+"vh",this.dragBox.style.height=this.HTMLElement.clientHeight-10)}}},C.Box=class e extends C.Container{constructor(e,t){super(e,t),this.properties.y=0,this.properties.type="Box",this.properties.scale=100,this.containerType="box",this.resizeHeight=!1,this.resizeWidth=!1,delete this.styleMappings.x,delete this.styleMappings.y,this.menus["Positioning and Size"]=[{id:"x",labelLeft:"X",labelRight:"%",type:"number"},{id:"y",labelLeft:"Y",labelRight:"%",type:"number"},{id:"scale",labelLeft:"Scale",labelRight:"%",type:"number"},{id:"layer",labelLeft:"Layer",type:"number"}],this.styleMappings.scale="scale",this.styleModifiers={scale:.01},this.update=()=>{this.deleted||(this.updateStyles(),this.HTMLElement.style.left=this.properties.x+"%",this.HTMLElement.style.top=this.properties.y+"%",this.HTMLElement.style.width="100vw",this.HTMLElement.style.height="100vh")}}},C.Free=class e extends C.Base{constructor(e,t){super(e,t),this.properties.type="Free",this.properties.resizable=!0,this.properties.draggable=!0,this.properties.bgColor="#000000",this.properties.bgOpacity=0,this.controls=this.controls.concat([{id:"round",titles:["Make object circular","Make object rectangular"],states:["circle","square"],state:0,activeState:-1},{id:"draggable",states:["drag_pan","drag_pan"],titles:["Enable dragging","Disable dragging"],state:0,activeState:1},{id:"resizable",states:["resize","resize"],titles:["Enable resizing","Disable resizing"],state:0,activeState:1},{id:"lockAspectRatio",states:["aspect_ratio","aspect_ratio"],titles:["Lock aspect ratio","Unlock aspect ratio"],state:0,activeState:1},{id:"centerx",states:["align_horizontal_center","align_horizontal_center"],titles:["Horizontally center object","Horizontally uncenter object"],state:0,activeState:1},{id:"centery",states:["align_vertical_center","align_vertical_center"],titles:["Vertically center object","Vertically uncenter object"],state:0,activeState:1}]),this.menus.Styles=this.menus.Styles.concat([{id:"bgColor",labelLeft:"Background color",type:"color"},{id:"bgOpacity",labelLeft:"Background opacity",labelRight:"%",type:"number"}]),this.instantiateBg=()=>{L.debug(`Instantiating background element for object ${this.properties.name}`);let e=document.createElement("div");e.className="bg",e.style.backgroundColor=this.properties.bgColor,e.style.opacity=this.properties.bgOpacity/100,e.style.width=this.properties.width,e.style.height=this.properties.height,e.style.zIndex=-2,this.HTMLElement.appendChild(e)},this.updateBg=()=>{let e=this.HTMLElement.querySelector(".bg");e.style.backgroundColor=this.properties.bgColor,e.style.opacity=this.properties.bgOpacity/100,e.style.width=this.properties.width,e.style.height=this.properties.height},this.update=()=>{this.updateStyles(),this.updateBg()},this.instantiate=()=>{this.instantiateBase(),this.instantiateBg(),this.update()}}},C.Rectangle=class e extends C.Free{constructor(e,t){super(e,t),this.properties.type="Rectangle"}},C.Image=class e extends C.Free{constructor(e,t){super(e,t),this.properties.type="Image",this.properties.imageURL="",this.properties.imageFiles=[],this.menus.Image=[{id:"imageURL",labelLeft:"Image URL",type:"text"},{id:"imageFiles",labelLeft:"OR Image File",type:"file"}],this.instantiateImage=()=>{L.debug(`Instantiating image for object ${this.properties.name}`);let e=document.createElement("img");e.className="lcedit-image",this.HTMLElement.appendChild(e)},this.updateImage=()=>{if(L.debug(`Updating image for object ${this.properties.name}`),this.properties.imageFiles[0]){let e=new FileReader;e.readAsDataURL(this.properties.imageFiles[0]),e.onload=()=>{this.properties.imageURL=e.result,this.HTMLElement.querySelector("img").src=this.properties.imageURL,this.properties.imageFiles=[]}}else this.HTMLElement.querySelector("img").src=this.properties.imageURL},this.update=()=>{this.updateStyles(),this.updateBg(),this.updateImage()},this.instantiate=()=>{this.instantiateBase(),this.instantiateBg(),this.instantiateImage(),this.update()}}},C.Text=class e extends C.Free{constructor(e,t){super(e,t),this.properties.height=36,this.properties.width=200,this.properties.type="Text",this.properties.fontWeight=400,this.properties.text="Text",this.properties.textColor="#000000",this.properties.centertextx=!1,this.properties.centertexty=!1,this.properties.lockAspectRatio=!0,this.properties.scaleText=!0,this.properties.fontSize=24,this.properties.font="sans-serif",this.properties.padding=5,this.aspectRatio=0===this.properties.height?1:this.properties.width/this.properties.height,this.controls=this.controls.concat([{id:"centertextx",states:["format_align_center","format_align_center"],titles:["Horizontally center text","Horizontally uncenter text"],state:0,activeState:1},{id:"centertexty",states:["vertical_align_center","vertical_align_center"],titles:["Vertically center text","Vertically uncenter text"],state:0,activeState:1},{id:"scaleText",states:["format_shapes","format_shapes"],titles:["Enable text scaling with box","Disable text scaling with box"],state:0,activeState:1}]),this.menus.Styles=this.menus.Styles.concat([{id:"bgColor",labelLeft:"Background color",type:"color"},{id:"bgOpacity",labelLeft:"Background opacity",labelRight:"%",type:"number"},{id:"font",labelLeft:"Font",type:"select",options:L.FONTS},{id:"fontSize",labelLeft:"Font size",labelRight:"px",type:"number"},{id:"textColor",labelLeft:"Text color",type:"color"},{id:"fontWeight",labelLeft:"Font style",type:"select-number",options:[{value:300,name:"Light"},{value:400,name:"Normal"},{value:500,name:"Medium"},{value:600,name:"Semibold"},{value:700,name:"Bold"},{value:800,name:"Extrabold"}]},{id:"padding",labelLeft:"Padding",labelRight:"px",type:"number"},]),this.styleMappings.fontWeight="fontWeight",this.styleMappings.textColor="color",this.styleMappings.fontSize="fontSize",this.styleMappings.font="fontFamily",this.styleMappings.centertextx="justify-content",this.styleMappings.centertexty="align-items",this.styleModifiers["align-items"]=["center","normal"],this.styleModifiers["justify-content"]=["center","left"],this.textRatio=this.properties.fontSize/this.properties.height,this.paddingRatio=this.properties.padding/this.properties.height,this.instantiateText=(e=!1,t=!0)=>{L.debug(`Instantiating text for object ${this.properties.name}`),t&&this.instantiateBg();let r=document.createElement("div");r.className=e?"odometer":"text",r.style.padding=this.properties.padding,this.HTMLElement.appendChild(r),r.innerText=this.properties.text},this.updateTextStyles=()=>{let e=this.HTMLElement.querySelector(".text")||this.HTMLElement.querySelector(".odometer");e.style.padding=this.properties.padding,this.properties.height>0&&(this.textRatio=this.properties.fontSize/this.properties.height,this.paddingRatio=this.properties.padding/this.properties.height)},this.updateText=()=>{L.debug(`Updating text for object ${this.properties.name}`),this.updateBg();let e=this.HTMLElement.querySelector(".text")||this.HTMLElement.querySelector(".odometer");this.updateTextStyles(),e.innerText=this.properties.text},this.update=()=>{this.updateStyles(),this.updateText()},this.instantiate=()=>{this.instantiateBase(),this.instantiateText(),this.update()}}},C.EditableText=class e extends C.Text{constructor(e,t){super(e,t),this.properties.type="EditableText",this.menus.Styles=this.menus.Styles.concat([{id:"text",labelLeft:"Text",type:"textbox",placeholder:"Text"}])}},C.Counter=class e extends C.Text{constructor(e,t){super(e,t),this.properties.type="Counter",this.properties.text="0",this.properties.value=0,this.properties.updateInterval=2,this.properties.paused=!1,this.properties.min=Number.MIN_SAFE_INTEGER,this.properties.max=Number.MAX_SAFE_INTEGER,this.properties.odoTime=2,this.updater=0,this.oldInterval=2,this.properties.downColor="#ff0000",this.properties.upColor="#00ff00",this.properties.updateColors=!1,this.controls=this.controls.concat([{id:"paused",states:["pause","play_arrow"],titles:["Pause counter","Play counter"],state:0,activeState:-1},{id:"updateColors",states:["palette","palette"],titles:["Enable update colors","Disable update colors"],state:0,activeState:1}]),this.menus.Styles=this.menus.Styles.concat([{id:"upColor",labelLeft:"Odometer up color",type:"color"},{id:"downColor",labelLeft:"Odometer down color",type:"color"}]),this.menus.Counter=[{id:"updateInterval",labelLeft:"Update Interval",labelRight:"seconds",type:"number"},{id:"odoTime",labelLeft:"Odometer animation",labelRight:"seconds",type:"number"}],this.updateCounter=()=>{this.properties.updateInterval=L.clamp(this.properties.updateInterval,L.MIN_INTERVAL/1e3,L.INT32_LIMIT/1e3),this.properties.text=Math.round(L.clamp(this.properties.value,this.properties.min,this.properties.max)).toString(),L.debug(`Updating counter ${this.properties.name}: Update interval ${this.properties.updateInterval}, Count ${this.properties.value}, Apparent Count ${this.getApparentCount()}`),this.updateText()},this.getApparentCount=()=>parseInt(this.properties.text)||0,this.instantiateCounter=()=>{this.properties.paused||(this.updater=setInterval(this.updateCounter,L.clamp(1e3*this.properties.updateInterval,L.MIN_INTERVAL,L.INT32_LIMIT)),this.updateCounter())},this.updateOdo=()=>{if(this.deleted)return;this.properties.odoTime=L.clamp(this.properties.odoTime,L.MIN_INTERVAL/1e3,this.properties.updateInterval),L.debug(`Updating odometer styles for counter ${this.properties.name}: Odometer time ${this.properties.odoTime}, Update colors ${this.properties.updateColors}, Up color ${this.properties.upColor}, Down color ${this.properties.downColor}`);let e=document.querySelector(`#style-${this.properties.name.hexEncode()}`);e||((e=document.createElement("style")).id=`style-${this.properties.name.hexEncode()}`,document.head.appendChild(e)),e.innerText=`#lcedit-${this.properties.name.hexEncode()} .odometer.odometer-auto-theme.odometer-animating-up .odometer-ribbon-inner,
            .odometer.odometer-theme-default.odometer-animating-up .odometer-ribbon-inner {
              -webkit-transition-duration: ${this.properties.odoTime}s !important;
              -moz-transition-duration: ${this.properties.odoTime}s !important;
              -ms-transition-duration: ${this.properties.odoTime}s !important;
              -o-transition-duration: ${this.properties.odoTime}s !important;
              transition-duration: ${this.properties.odoTime}s !important
            }
            
            #lcedit-${this.properties.name.hexEncode()}  .odometer.odometer-auto-theme.odometer-animating-down.odometer-animating .odometer-ribbon-inner,
            .odometer.odometer-theme-default.odometer-animating-down.odometer-animating .odometer-ribbon-inner {
              -webkit-transition-duration: ${this.properties.odoTime}s !important;
              -moz-transition-duration: ${this.properties.odoTime}s !important;
              -ms-transition-duration: ${this.properties.odoTime}s !important;
              -o-transition-duration: ${this.properties.odoTime}s !important;
              transition-duration: ${this.properties.odoTime}s !important
            }`,this.properties.updateColors&&(e.innerText+=`#lcedit-${this.properties.name.hexEncode()} .odometer.odometer-auto-theme.odometer-animating-up .odometer-ribbon-inner,
            .odometer.odometer-theme-default.odometer-animating-up .odometer-ribbon-inner {
                color: ${this.properties.upColor};
            }
            #lcedit-${this.properties.name.hexEncode()} .odometer.odometer-auto-theme.odometer-animating-up .odometer-formatting-mark,
            .odometer.odometer-theme-default.odometer-animating-up .odometer-formatting-mark {
                color: ${this.properties.upColor};
            }
            #lcedit-${this.properties.name.hexEncode()} .odometer.odometer-auto-theme.odometer-animating-down.odometer-animating .odometer-ribbon-inner,
            .odometer.odometer-theme-default.odometer-animating-down.odometer-animating .odometer-ribbon-inner {
                color: ${this.properties.downColor};
            }
            #lcedit-${this.properties.name.hexEncode()} .odometer.odometer-auto-theme.odometer-animating-down .odometer-formatting-mark,
            .odometer.odometer-theme-default.odometer-animating-down .odometer-formatting-mark {
                color: ${this.properties.downColor};
            }`)},this.updateCounterInterval=()=>{!this.properties.paused&&this.oldInterval!==this.properties.updateInterval&&this.updater&&(clearInterval(this.updater),L.debug(`Changing update interval for counter ${this.properties.name}: Old interval ${this.oldInterval}, New interval ${this.properties.updateInterval}`),this.oldInterval=this.properties.updateInterval,this.updater=setInterval(this.updateCounter,L.clamp(1e3*this.properties.updateInterval,L.MIN_INTERVAL,L.INT32_LIMIT)),L.debug(`Started updater for counter ${this.properties.name}: ID ${this.updater}`),this.updateCounter(),Odometer.init()),this.properties.paused&&this.updater&&(L.debug(`Paused counter ${this.properties.name} with old updater ID ${this.updater}`),clearInterval(this.updater),this.updater=0),this.properties.paused||this.updater||(this.updater=setInterval(this.updateCounter,L.clamp(1e3*this.properties.updateInterval,L.MIN_INTERVAL,L.INT32_LIMIT)),this.updateCounter(),L.debug(`Started updater for counter ${this.properties.name}: ID ${this.updater}`),Odometer.init())},this.update=()=>{this.updateStyles(),this.updateTextStyles(),this.updateOdo(),this.updateCounterInterval()},this.instantiate=()=>{this.instantiateBase(),this.instantiateText(!0),this.instantiateCounter(),this.update()}}},C.CustomCounter=class e extends C.Counter{constructor(e,t){super(e,t),this.properties.type="CustomCounter",this.properties.abbreviated=!0,this.properties.min=0,this.properties.gainType=0,this.properties.minRate=0,this.properties.maxRate=0,this.properties.meanRate=0,this.properties.stdevRate=0,this.properties.customRate="",this.properties.gainPer=2,this.controls=this.controls.concat([{id:"abbreviated",states:["decimal_decrease","decimal_increase"],titles:["Abbreviate counter","Unabbreviate counter"],state:0,activeState:-1}]),this.menus.Counter=this.menus.Counter.concat([{id:"value",labelLeft:"Count",type:"number"},{id:"min",labelLeft:"Minimum value",type:"number"},{id:"max",labelLeft:"Maximum value",type:"number"}]),this.menus.Gain=[{id:"gainType",labelLeft:"Gain Type",type:"select-number",options:[{value:0,name:"Uniform (default)"},{value:1,name:"Gaussian"},{value:2,name:"Custom"}],updateMenu:!0},{id:"minRate",labelLeft:"Min Gain",type:"number",condition:"gainType",conditionalValue:0},{id:"maxRate",labelLeft:"Max Gain",type:"number",condition:"gainType",conditionalValue:0},{id:"meanRate",labelLeft:"Mean Gain",type:"number",condition:"gainType",conditionalValue:1},{id:"stdevRate",labelLeft:"Standard Deviation",type:"number",condition:"gainType",conditionalValue:1},{id:"customRate",labelLeft:"Custom Distribution",type:"textbox",condition:"gainType",conditionalValue:2,placeholder:"Min,Max,Weight\nNew line for each entry"},{id:"gainPer",labelLeft:"Per every",labelRight:"seconds",type:"number"}],this.customDistributionData={},this.updateCounter=()=>{this.properties.updateInterval=L.clamp(this.properties.updateInterval,L.MIN_INTERVAL/1e3,L.INT32_LIMIT/1e3),(this.properties.gainPer<.001||isNaN(this.properties.gainPer))&&(this.properties.gainPer=2),isNaN(this.properties.value)&&(this.properties.value=0);let e=0,t=this.properties.updateInterval/this.properties.gainPer;switch(this.properties.gainType){case 0:e=L.random(this.properties.minRate,this.properties.maxRate)*t;break;case 1:e=L.randomGaussian(this.properties.meanRate,this.properties.stdevRate)*t;break;case 2:this.customDistributionData=L.createCustomDistribution(this.properties.customRate),e=L.randomFromCustomDistribution(this.customDistributionData)*t}if(this.properties.value=L.clamp(this.properties.value+e,this.properties.min,this.properties.max),this.properties.abbreviated?this.properties.text=Math.round(L.abb(this.properties.value)).toString():this.properties.text=Math.round(this.properties.value).toString(),L.debug(`Updating counter ${this.properties.name}: Update interval ${this.properties.updateInterval}, Count ${this.properties.value}, Apparent Count ${this.getApparentCount()}, Gain ${e}, Conversion Factor ${t}`),this.updateText(),L.selectMenu.value===this.properties.name){let r=document.querySelector(".count-input");r&&(r.value=this.properties.value,L.debug(`Changed value of counter input box for ${this.properties.name}`))}this.updateGraph&&this.updateGraph()}}},C.Channel=class e extends C.CustomCounter{constructor(e,t){super(e,t),this.properties.type="Channel",this.properties.showTitle=!0,this.properties.title="Channel",this.properties.showImage=!0,this.properties.imageURL="",this.properties.imageFiles="",this.properties.width=256,this.properties.height=56,this.properties.showGraph=!1,this.properties.lineColor="#ff0000",this.properties.values=[],this.properties.bgColor="#ffffff",this.properties.bgOpacity=100,this.properties.rank="01",this.properties.showRank=!1,this.properties.padding=0,this.properties.maxValues=100,this.aspectRatio=0===this.properties.height?1:this.properties.width/this.properties.height,this.controls=this.controls.concat([{id:"showTitle",states:["title","title"],titles:["Show title","Hide title"],state:0,activeState:1},{id:"showImage",states:["image","image"],titles:["Show image","Hide image"],state:0,activeState:1},{id:"showGraph",states:["show_chart","show_chart"],titles:["Show graph","Hide graph"],state:0,activeState:1},{states:["clear_all"],titles:["Clear all graph values"],state:0,activeState:-1,function:()=>{this.chart.series[0].setData([]),this.properties.values=[]}}]),this.menus.Styles=this.menus.Styles.concat([{id:"lineColor",labelLeft:"Graph color",type:"color"}]),this.menus.Counter=this.menus.Counter.concat([{id:"title",labelLeft:"Title",type:"text"}]),this.menus.Image=[{id:"imageURL",labelLeft:"Image URL",type:"text"},{id:"imageFiles",labelLeft:"OR Image File",type:"file"}],this.getValues=()=>this.properties.values,this.getGraphOptions=()=>{let e={chart:{renderTo:this.graphElement,type:"spline",backgroundColor:"transparent",plotBorderColor:"transparent",style:{width:"100%",height:"100%"},spacing:[0,0,0,0]},title:{text:void 0},xAxis:{type:"datetime",visible:!1},yAxis:{visible:!1},credits:{enabled:!1},series:[{name:"Count",marker:{enabled:!1},showInLegend:!1,color:this.properties.lineColor,lineColor:this.properties.lineColor,lineWidth:2,data:this.getValues()}]};return e},this.instantiateChannel=()=>{this.HTMLElement.className+=" lcedit-channel";let e=document.createElement("div");e.className="lcedit-channel-rank",this.rankElement=e,e.innerText=this.properties.rank,this.HTMLElement.appendChild(e);let t=document.createElement("img");t.className="lcedit-channel-image",this.imageElement=t,this.HTMLElement.appendChild(t);let r=document.createElement("div");r.className="lcedit-channel-graph",this.graphElement=r,this.HTMLElement.appendChild(r),this.chart=new Highcharts.chart(this.getGraphOptions());let s=document.createElement("div");s.className="lcedit-channel-title",s.innerText=this.properties.title,this.titleElement=s,this.HTMLElement.appendChild(s)},this.instantiate=()=>{this.instantiateBase(),this.instantiateBg(),this.instantiateChannel(),this.instantiateText(!0,!1),this.instantiateCounter(),this.update()},this.updateImage=()=>{if(this.imageElement){if(this.imageElement.style.width=this.imageElement.clientHeight,L.debug(`Updating image for object ${this.properties.name}`),this.properties.imageFiles[0]){let e=new FileReader;e.readAsDataURL(this.properties.imageFiles[0]),e.onload=()=>{this.properties.imageURL=e.result,this.imageElement.src=this.properties.imageURL,this.properties.imageFiles=[]}}else this.imageElement.src=this.properties.imageURL}},this.updateGraph=()=>{if(this.properties.showGraph||(this.chart.series[0].setData([]),this.properties.values=[]),this.properties.maxValues=L.clamp(this.properties.maxValues,3,1e3),this.chart){for(;this.chart.series[0].data.length>=this.properties.maxValues;)L.debug(`Removing point (${this.chart.series[0].data[0].x}, ${this.chart.series[0].data[0].y}) from graph ${this.properties.name}`),this.chart.series[0].removePoint(0);L.debug(`Adding point (${Date.now()}, ${this.getApparentCount()}) to graph ${this.properties.name}`),this.chart.series[0].addPoint([Date.now(),this.getApparentCount()]),this.properties.values=this.chart.series[0].data.map(e=>[e.x,e.y])}},this.updateGraphSize=()=>{this.chart&&this.chart.setSize(this.HTMLElement.clientWidth-this.imageElement.clientWidth-this.rankElement.clientWidth,this.HTMLElement.clientHeight,!1)},this.updateGraphStyles=()=>{this.chart&&this.chart.update(this.getGraphOptions())},this.update=()=>{this.deleted||(this.updateStyles(),this.updateTextStyles(),this.updateOdo(),this.updateCounterInterval(),this.properties.width=this.HTMLElement.clientWidth,this.properties.height=this.HTMLElement.clientHeight,this.titleElement.innerText=this.properties.showTitle?this.properties.title:"",this.rankElement.innerText=this.properties.showRank?this.properties.rank:"",this.imageElement.style.display=this.properties.showImage?"":"none",this.updateBg(),this.updateImage(),this.updateGraphSize(),this.updateGraphStyles())}}},C.CompareCounter=class e extends C.Counter{constructor(e,t){super(e,t),this.properties.type="CompareCounter",this.properties.min=-1/0,this.properties.max=1/0,this.properties.mode=0,this.properties.counterA="",this.properties.counterB="",this.controls=this.controls.concat([{states:["sync"],titles:["Sync update intervals"],state:0,activeState:-1,function:()=>{let e=L.getObjectByName(this.properties.counterA),t=L.getObjectByName(this.properties.counterB);e&&(e.properties.paused=!0,e.update(),e.properties.updateInterval=this.properties.updateInterval,e.properties.paused=!1,e.update()),t&&(t.properties.paused=!0,t.update(),t.properties.updateInterval=this.properties.updateInterval,t.properties.paused=!1,t.update()),this.properties.paused=!0,this.update(),this.properties.paused=!1,this.update()}}]),this.menus.Counter=this.menus.Counter.concat([{id:"mode",labelLeft:"Mode",type:"select-number",options:[{value:0,name:"Absolute Difference"},{value:1,name:"A minus B"},{value:2,name:"B minus A"},{value:3,name:"Sum"},{value:4,name:"Product"},{value:5,name:"A divded by B"},{value:6,name:"B divided by A"}]},{id:"counterA",labelLeft:"Counter A",type:"select",options:L.getAllChannels(this.properties.name),updateMenu:!0,optionsFunction:L.getAllChannels},{id:"counterB",labelLeft:"Counter B",type:"select",options:L.getAllChannels(this.properties.name),updateMenu:!0,optionsFunction:L.getAllChannels},]),this.updateCounter=()=>{let e=L.getObjectByName(this.properties.counterA),t=L.getObjectByName(this.properties.counterB),r=0,s=0;e instanceof C.Counter&&(r=e.getApparentCount()),t instanceof C.Counter&&(s=t.getApparentCount());let a=0;switch(this.properties.mode){case 0:a=Math.abs(r-s);break;case 1:a=r-s;break;case 2:a=s-r;break;case 3:a=r+s;break;case 4:a=r*s;break;case 5:a=r/s;break;case 6:a=s/r}this.properties.value=a,isFinite(this.properties.value)?this.properties.text=Math.round(this.properties.value).toString():L.warn(`Compare counter ${this.properties.name} has an invalid value: Likely a division by zero error`),this.updateText()}}},C.Graph=class e extends C.Free{constructor(e,t){super(e,t),this.properties.type="Graph",this.properties.title="",this.properties.font="sans-serif",this.properties.labelColor="#aaaaaa",this.properties.lineColor="#ff0000",this.properties.titleColor="#000000",this.properties.gridColor="#999999",this.properties.bgColor="#000000",this.properties.bgOpacity=0,this.menus.Styles=this.menus.Styles.concat([{id:"font",labelLeft:"Font",type:"select",options:L.FONTS},{id:"title",labelLeft:"Title",type:"text"},{id:"titleColor",labelLeft:"Title color",type:"color"},{id:"lineColor",labelLeft:"Graph color",type:"color"},{id:"labelColor",labelLeft:"Label color",type:"color"},{id:"gridColor",labelLeft:"Gridline color",type:"color"},]),this.getValues=()=>[],this.getGraphOptions=(e=!1)=>{let t={chart:{renderTo:this.graphElement,type:"spline",zoomType:"x",backgroundColor:"transparent",plotBorderColor:"transparent",style:{fontFamily:this.properties.font,width:"100%",height:"100%"}},title:{text:this.properties.title,style:{color:this.properties.titleColor}},xAxis:{type:"datetime",grindLineColor:this.properties.gridColor,labels:{style:{color:this.properties.labelColor}},lineColor:this.properties.gridColor,tickColor:this.properties.labelColor,title:{text:""}},yAxis:{title:{text:""},labels:{style:{color:this.properties.labelColor}},gridLineColor:this.properties.gridColor,lineColor:this.properties.gridColor,tickColor:this.properties.labelColor},series:[{name:"Count",marker:{enabled:!1},showInLegend:!1,color:this.properties.lineColor,lineColor:this.properties.lineColor,lineWidth:2,data:this.getValues()}]};return t},this.instantiateGraph=()=>{let e=document.createElement("div");this.graphElement=e,this.HTMLElement.appendChild(e),this.chart=new Highcharts.chart(this.getGraphOptions())},this.updateGraphSize=()=>{this.chart&&this.chart.setSize(this.HTMLElement.clientWidth,this.HTMLElement.clientHeight,!1)},this.updateGraphStyles=()=>{this.chart&&this.chart.update(this.getGraphOptions())},this.update=()=>{this.deleted||(this.updateStyles(),this.updateBg(),this.updateGraphSize(),this.updateGraphStyles())},this.instantiate=()=>{this.instantiateBase(),this.instantiateBg(),this.instantiateGraph(),this.update()}}},C.StaticGraph=class e extends C.Graph{constructor(e,t){super(e,t),this.properties.type="StaticGraph",this.properties.values="",this.properties.minDate="",this.properties.maxDate="",this.menus.Graph=[{id:"values",labelLeft:"Graph values",placeholder:"Values separated by commas e.g. 1,2,3",type:"textbox"},{id:"minDate",labelLeft:"Earliest Date",type:"datetime-local"},{id:"maxDate",labelLeft:"Latest Date",type:"datetime-local"},],this.getValues=()=>{let e=new Date(this.properties.minDate).getTime(),t=new Date(this.properties.maxDate).getTime(),r=[],s=this.properties.values.replace(/ +/g,"").split(","),a=0;for(s.length>1&&(a=(t-e)/(s.length-1)),i=0;i<s.length;i++)r.push([e+i*a,parseFloat(s[i],10)||0]);return r},this.updateGraph=()=>{this.chart&&this.chart.series[0].setData(this.getValues()),this.updateGraphStyles()}}},C.LiveGraph=class e extends C.Graph{constructor(e,t){super(e,t),this.properties.type="LiveGraph",this.properties.values=[],this.properties.maxValues=100,this.properties.keepValues=!0,this.properties.counter="",this.properties.paused=!1,this.properties.updateInterval=2,this.updater=0,this.oldInterval=2,this.controls=this.controls.concat([{id:"paused",states:["pause","play_arrow"],titles:["Pause counter","Play counter"],state:0,activeState:-1},{states:["sync"],titles:["Sync update intervals"],state:0,activeState:-1,function:()=>{let e=L.getObjectByName(this.properties.counter);e&&(e.properties.paused=!0,e.update(),e.properties.updateInterval=this.properties.updateInterval,e.properties.paused=!1,e.update()),this.properties.paused=!0,this.update(),this.properties.paused=!1,this.update()}},{states:["clear_all"],titles:["Clear all graph values"],state:0,activeState:-1,function:()=>{this.chart.series[0].setData([]),this.properties.values=[]}}]),this.menus.Graph=[{id:"counter",labelLeft:"Counter",type:"select",options:L.getAllChannels(),updateMenu:!0,optionsFunction:L.getAllChannels},{id:"keepValues",labelLeft:"Keep values after reload",type:"checkbox"},{id:"maxValues",labelLeft:"Max values",type:"number"},{id:"updateInterval",labelLeft:"Update Interval",labelRight:"seconds",type:"number"}],this.getValues=()=>this.properties.values,this.updateGraph=()=>{this.properties.maxValues=L.clamp(this.properties.maxValues,3,1e3);let e=L.getObjectByName(this.properties.counter);if(e&&this.chart){for(;this.chart.series[0].data.length>=this.properties.maxValues;)L.debug(`Removing point (${this.chart.series[0].data[0].x}, ${this.chart.series[0].data[0].y}) from graph ${this.properties.name}`),this.chart.series[0].removePoint(0);L.debug(`Adding point (${Date.now()}, ${e.getApparentCount()}) to graph ${this.properties.name}`),this.chart.series[0].addPoint([Date.now(),e.getApparentCount()]),this.properties.values=this.chart.series[0].data.map(e=>[e.x,e.y])}},this.update=()=>{this.deleted||(this.updateStyles(),this.updateBg(),this.updateGraphSize(),this.updateGraphStyles(),!this.properties.paused&&this.oldInterval!==this.properties.updateInterval&&this.updater&&(clearInterval(this.updater),L.debug(`Changing update interval for graph ${this.properties.name}: Old interval ${this.oldInterval}, New interval ${this.properties.updateInterval}`),this.oldInterval=this.properties.updateInterval,this.updater=setInterval(this.updateGraph,L.clamp(1e3*this.properties.updateInterval,L.MIN_GRAPH_INTERVAL,L.INT32_LIMIT)),L.debug(`Started updater for graph ${this.properties.name}: ID ${this.updater}`),this.updateGraph()),this.properties.paused&&this.updater&&(clearInterval(this.updater),L.debug(`Paused graph ${this.properties.name} with old updater ID ${this.updater}`),this.updater=0),this.properties.paused||this.updater||(this.updater=setInterval(this.updateGraph,L.clamp(1e3*this.properties.updateInterval,L.MIN_GRAPH_INTERVAL,L.INT32_LIMIT)),this.updateGraph(),L.debug(`Started updater for graph ${this.properties.name}: ID ${this.updater}`)))},this.instantiate=()=>{this.instantiateBase(),this.instantiateBg(),this.properties.keepValues||(this.properties.values=[]),this.instantiateGraph(),this.update()}}},window.onload=()=>{L.selectMenu.addEventListener("input",e=>{L.generateMenu(L.getObjectByName(e.target.value))}),L.fileImport.addEventListener("change",()=>{L.fileImport.files[0]&&L.fileImport.files[0].text().then(e=>{L.importFromJSON(e,!0)})}),L.top50Import.addEventListener("change",()=>{L.top50Import.files[0]&&L.top50Import.files[0].text().then(e=>{L.importFromTop50(e)})}),L.ytsImport.addEventListener("change",()=>{L.ytsImport.files[0]&&L.ytsImport.files[0].text().then(e=>{L.importFromYTStudio(e)})}),L.bgColorSelect.addEventListener("input",e=>{document.body.style.backgroundColor=e.target.value,L.bgColor=e.target.value});let e=localStorage.getItem("lcbeta");e&&L.importFromJSON(e),setInterval(L.saveInBrowser,1e4),L.toggleDebug(),L.bgColorSelect.value=L.bgColor},addEventListener("resize",e=>{for(L.debug("Window resized"),i=0;i<L.objectList.length;i++)L.objectList[i].updateStyles()});