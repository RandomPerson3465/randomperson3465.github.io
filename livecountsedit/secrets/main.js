const INT32_LIMIT=2147483647,workspace=document.querySelector(".workspace"),quickSelectButton=document.querySelector("#quickSelect"),selectMenu=document.querySelector("#objectSelect"),objectMenu=document.querySelector("#objectMenu"),fileImport=document.querySelector("#fileImport");function clamp(e,t=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER){return isNaN(e)&&(e=0),e<t?t:e>i?i:e}function abb(e){let t=Math.sign(e);return(e=Math.abs(e))<1?0:t*Math.floor(e/10**(Math.floor(Math.log10(e))-2))*10**(Math.floor(Math.log10(e))-2)}function random(e=0,t=1){return parseFloat(e)+Math.random()*(parseFloat(t)-parseFloat(e))||0}function randomGaussian(e,t){let i=0,s=0;for(;!i;)i=Math.random();for(;!s;)s=Math.random();return Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s)*parseFloat(t)+parseFloat(e)}function randomFromCustomDistribution(e){if("object"!=typeof e||!e.entries||!e.entries.length||!e.totalWeight||e.totalWeight<0)return 0;const t=Math.random()*e.totalWeight;let i=0;for(;t>e.entries[i]?.cutoff&&e.entries[i];)i++;return random(e.entries[i].min,e.entries[i].max)}function createCustomDistribution(e){const t={totalWeight:0,entries:[]};let s=0;const r=e.split("\n");for(i=0;i<r.length;i++){const e=r[i].split(",");s+=parseFloat(e[2])||0;const n={min:parseFloat(e[0])||0,max:parseFloat(e[1])||0,cutoff:s};t.entries.push(n),t.totalWeight=s}return t}function updateMenu(e){const t=objectMenu.querySelectorAll("input,textarea,select");for(i=0;i<t.length;i++)"file"!==e.menus[i].type&&("checkbox"===e.menus[i].type?t[i].checked=e.properties[e.menus[i].id]:t[i].value=e.properties[e.menus[i].id],e.menus[i].condition&&(e.properties[e.menus[i].condition]!==e.menus[i].conditionalValue?(t[i].parentElement.style.display="none",t[i].parentElement.nextElementSibling.style.display="none"):(t[i].parentElement.style.display="inline",t[i].parentElement.nextElementSibling.style.display="inline")))}class BaseObject{constructor(e,t){this.properties={type:"BaseObject",x:0,y:30,width:100,height:100,draggable:!0,resizable:!0,visible:!0,opacity:100,layer:0,name:e,round:!1},this.HTMLElement=t,this.dragBox=null,this.menus=[{id:"x",labelLeft:"X",labelRight:"px",type:"number"},{id:"y",labelLeft:"Y",labelRight:"px",type:"number"},{id:"width",labelLeft:"Width",labelRight:"px",type:"number"},{id:"height",labelLeft:"Height",labelRight:"px",type:"number"},{id:"draggable",labelLeft:"Draggable",type:"checkbox"},{id:"resizable",labelLeft:"Resizable",type:"checkbox"},{id:"visible",labelLeft:"Visible",type:"checkbox"},{id:"opacity",labelLeft:"Opacity",labelRight:"%",type:"number"},{id:"layer",labelLeft:"Layer",type:"number"},{id:"round",labelLeft:"Rounded",type:"checkbox"}],this.styleMappings={x:"left",y:"top",width:"width",height:"height",resizable:"resize",visible:"visibility",opacity:"opacity",layer:"z-index",round:"border-radius"},this.styleModifiers={opacity:.01,resize:["both","none"],visibility:["visible","hidden"],cursor:["move","default"],"border-radius":["50%","0%"]}}updateStyles(){this.dragBox&&(this.dragBox.style.width=this.properties.width,this.dragBox.style.height=this.properties.resizable?this.properties.height-10:this.properties.height,this.properties.draggable?this.dragBox.style.cursor="move":this.dragBox.style.cursor="default");for(const e of Object.keys(this.styleMappings)){let t=this.styleMappings[e],i=this.properties[e];this.styleModifiers[t]&&("number"==typeof this.styleModifiers[t]&&(i*=this.styleModifiers[t]),this.styleModifiers[t]instanceof Array&&(i=i?this.styleModifiers[t][0]:this.styleModifiers[t][1])),this.HTMLElement.style[t]=i}}instantiateBase(){const e=document.querySelector(".workspace"),t=document.createElement("div");t.className="lcedit-object",t.id="lcedit-"+this.properties.name;const i=document.createElement("div");i.style.width=this.properties.width,i.style.height=this.properties.height-10,i.className="dragbox",i.style.zIndex=2,t.appendChild(i),this.dragBox=i,this.HTMLElement=t,e.appendChild(t)}update(){this.updateStyles()}instantiate(){this.instantiateBase(),this.update()}}class Rectangle extends BaseObject{constructor(e,t){super(e,t),this.properties.type="Rectangle",this.properties.bgColor="#000000",this.menus=this.menus.concat([{id:"bgColor",labelLeft:"Background color",type:"color"}]),this.styleMappings.bgColor="backgroundColor"}}class Image extends BaseObject{constructor(e,t){super(e,t),this.properties.type="Image",this.properties.imageURL="",this.properties.imageFiles=[],this.menus=this.menus.concat([{id:"imageURL",labelLeft:"Image URL",type:"text"},{id:"imageFiles",labelLeft:"OR Image File",type:"file"}]),this.instantiateImage=()=>{const e=document.createElement("img");this.HTMLElement.appendChild(e)},this.updateImage=()=>{if(this.properties.imageFiles[0]){const e=new FileReader;e.readAsDataURL(this.properties.imageFiles[0]),e.onload=()=>{this.properties.imageURL=e.result,this.HTMLElement.querySelector("img").src=this.properties.imageURL,this.properties.imageFiles=[]}}else this.HTMLElement.querySelector("img").src=this.properties.imageURL},this.update=()=>{this.updateStyles(),this.updateImage()},this.instantiate=()=>{this.instantiateBase(),this.instantiateImage(),this.update()}}}class Text extends BaseObject{constructor(e,t){super(e,t),this.properties.height=34,this.properties.type="Text",this.properties.bgColor="#000000",this.properties.bgOpacity=0,this.properties.fontWeight=400,this.properties.text="Text",this.properties.textColor="#000000",this.properties.scaleText=!0,this.properties.fontSize=24,this.properties.font="sans-serif",this.properties.padding=5,this.menus=this.menus.concat([{id:"bgColor",labelLeft:"Background color",type:"color"},{id:"bgOpacity",labelLeft:"Background opacity",labelRight:"%",type:"number"},{id:"font",labelLeft:"Font",type:"select",options:[{value:"Arial",name:"Arial"},{value:"Roboto",name:"Roboto"},{value:"Lato",name:"Lato"},{value:"sans-serif",name:"Sans Serif"},{value:"serif",name:"Serif"}]},{id:"fontSize",labelLeft:"Font size",labelRight:"px",type:"number"},{id:"textColor",labelLeft:"Text color",type:"color"},{id:"fontWeight",labelLeft:"Font style",type:"select-number",options:[{value:300,name:"Thin"},{value:400,name:"Normal"},{value:700,name:"Bold"}]},{id:"scaleText",labelLeft:"Scale text with box height",type:"checkbox"},{id:"padding",labelLeft:"Padding",labelRight:"px",type:"number"}]),this.styleMappings.fontWeight="fontWeight",this.styleMappings.textColor="color",this.styleMappings.fontSize="fontSize",this.styleMappings.font="fontFamily",this.textRatio=this.properties.fontSize/this.properties.height,this.paddingRatio=this.properties.padding/this.properties.height,this.instantiateText=(e=!1)=>{const t=document.createElement("div");t.className="bg",t.style.backgroundColor=this.properties.bgColor,t.style.opacity=this.properties.bgOpacity/100,t.style.width=this.properties.width,t.style.height=this.properties.height,t.style.zIndex=-1,this.HTMLElement.appendChild(t);const i=document.createElement("div");i.className=e?"odometer":"text",i.style.zIndex=1,i.style.padding=this.properties.padding,this.HTMLElement.appendChild(i),i.innerText=this.properties.text},this.updateTextStyles=()=>{const e=this.HTMLElement.querySelector(".bg"),t=this.HTMLElement.querySelector(".text")||this.HTMLElement.querySelector(".odometer");e.style.backgroundColor=this.properties.bgColor,e.style.opacity=this.properties.bgOpacity/100,e.style.width=this.properties.width,e.style.height=this.properties.height,t.style.padding=this.properties.padding,this.properties.height>0&&(this.textRatio=this.properties.fontSize/this.properties.height,this.paddingRatio=this.properties.padding/this.properties.height)},this.updateText=()=>{const e=this.HTMLElement.querySelector(".text")||this.HTMLElement.querySelector(".odometer");this.updateTextStyles(),e.innerText=this.properties.text},this.update=()=>{this.updateStyles(),this.updateText()},this.instantiate=()=>{this.instantiateBase(),this.instantiateText(),this.update()}}}class EditableText extends Text{constructor(e,t){super(e,t),this.properties.type="EditableText",this.menus=this.menus.concat([{id:"text",labelLeft:"Text",type:"textbox",placeholder:"Text"}])}}class Counter extends Text{constructor(e,t){super(e,t),this.properties.type="Counter",this.properties.text="0",this.properties.value=0,this.properties.updateInterval=2,this.properties.paused=!1,this.properties.min=Number.MIN_SAFE_INTEGER,this.properties.max=Number.MAX_SAFE_INTEGER,this.updater=0,this.oldInterval=2,this.menus=this.menus.concat([{id:"updateInterval",labelLeft:"Update Interval",labelRight:"seconds",type:"number"},{id:"min",labelLeft:"Minimum value",type:"number"},{id:"max",labelLeft:"Maximum value",type:"number"},{id:"paused",labelLeft:"Paused",type:"checkbox"}]),this.updateCounter=()=>{this.properties.updateInterval=clamp(this.properties.updateInterval,.5,2147483.647),this.properties.text=Math.round(clamp(this.properties.value,this.properties.min,this.properties.max)).toString(),this.updateText()},this.instantiateCounter=()=>{this.properties.paused||(this.updater=setInterval(this.updateCounter,clamp(1e3*this.properties.updateInterval,500,2147483647)),this.updateCounter())},this.update=()=>{this.updateStyles(),this.updateTextStyles(),!this.properties.paused&&this.oldInterval!==this.properties.updateInterval&&this.updater&&(clearInterval(this.updater),this.oldInterval=this.properties.updateInterval,this.updater=setInterval(this.updateCounter,clamp(1e3*this.properties.updateInterval,500,2147483647)),this.updateCounter()),this.properties.paused&&this.updater&&(clearInterval(this.updater),this.updater=0),this.properties.paused||this.updater||(this.updater=setInterval(this.updateCounter,clamp(1e3*this.properties.updateInterval,500,2147483647)),this.updateCounter())},this.instantiate=()=>{this.instantiateBase(),this.instantiateText(!0),this.instantiateCounter(),this.update()}}}class CustomCounter extends Counter{constructor(e,t){super(e,t),this.properties.type="CustomCounter",this.properties.abbreviated=!0,this.properties.min=0,this.properties.gainType=0,this.properties.minRate=0,this.properties.maxRate=0,this.properties.meanRate=0,this.properties.stdevRate=0,this.properties.customRate="",this.properties.gainPer=2,this.menus=this.menus.concat([{id:"value",labelLeft:"Count",type:"number"},{id:"abbreviated",labelLeft:"Abbreviate",type:"checkbox"},{id:"gainType",labelLeft:"Gain Type",type:"select-number",options:[{value:0,name:"Uniform (default)"},{value:1,name:"Gaussian"},{value:2,name:"Custom"}],updateMenu:!0},{id:"minRate",labelLeft:"Min Gain",type:"number",condition:"gainType",conditionalValue:0},{id:"maxRate",labelLeft:"Max Gain",type:"number",condition:"gainType",conditionalValue:0},{id:"meanRate",labelLeft:"Mean Gain",type:"number",condition:"gainType",conditionalValue:1},{id:"stdevRate",labelLeft:"Standard Deviation",type:"number",condition:"gainType",conditionalValue:1},{id:"customRate",labelLeft:"Custom Distribution",type:"textbox",condition:"gainType",conditionalValue:2,placeholder:"Min,Max,Weight\nNew line for each entry"},{id:"gainPer",labelLeft:"Per every",labelRight:"seconds",type:"number"}]),this.customDistributionData={},this.updateCounter=()=>{this.properties.updateInterval=clamp(this.properties.updateInterval,.5,2147483.647),(this.properties.gainPer<.001||isNaN(this.properties.gainPer))&&(this.properties.gainPer=2),isNaN(this.properties.value)&&(this.properties.value=0);let e=0;const t=this.properties.updateInterval/this.properties.gainPer;switch(this.properties.gainType){case 0:e=random(this.properties.minRate,this.properties.maxRate)*t;break;case 1:e=randomGaussian(this.properties.meanRate,this.properties.stdevRate)*t;break;case 2:this.customDistributionData=createCustomDistribution(this.properties.customRate),e=randomFromCustomDistribution(this.customDistributionData)*t}this.properties.value=clamp(this.properties.value+e,this.properties.min,this.properties.max),this.properties.abbreviated?this.properties.text=Math.round(abb(this.properties.value)).toString():this.properties.text=Math.round(this.properties.value).toString(),this.updateText(),selectMenu.value===this.properties.name&&updateMenu(this)}}}function toggleMenu(){const e=document.querySelector(".menu");"visible"==e.style.visibility?e.style.visibility="hidden":e.style.visibility="visible"}let objectList=[];function getObjectByName(e){return objectList.filter((t=>t.properties.name===e))[0]}function getObjectByElementId(e){if(e&&e.startsWith("lcedit-"))return getObjectByName(e.replace("lcedit-",""))}function deleteCurrentObject(){objectMenu.replaceChildren([]);const e=getObjectByName(selectMenu.value);e&&(e instanceof Counter&&clearInterval(e.updater),e.HTMLElement.remove()),objectList=objectList.filter((e=>e.properties.name!==selectMenu.value)),generateSelect()}function generateMenu(e){if(!e)return;objectMenu.replaceChildren([]);for(const t of e.menus){const i=document.createElement("span");switch(t.labelLeft&&(i.innerHTML+=t.labelLeft+" "),t.type){case"textbox":inputBox=document.createElement("textarea");break;case"select-number":case"select":inputBox=document.createElement("select");for(const e of t.options){const t=document.createElement("option");t.value=e.value,t.innerText=e.name,inputBox.appendChild(t)}break;default:inputBox=document.createElement("input")}if(inputBox.setAttribute("type",t.type),t.placeholder&&inputBox.setAttribute("placeholder",t.placeholder),"file"===t.type&&inputBox.setAttribute("accept","image/png, image/jpeg"),inputBox.addEventListener("input",(i=>{"number"===t.type||"select-number"===t.type?e.properties[t.id]=Number(i.target.value)||0:"checkbox"===t.type?e.properties[t.id]=i.target.checked:"file"===t.type?e.properties[t.id]=i.target.files:e.properties[t.id]=i.target.value,e.update(),t.updateMenu&&updateMenu(e)})),i.appendChild(inputBox),t.labelRight){const e=document.createElement("span");e.innerText=" "+t.labelRight,i.appendChild(e)}objectMenu.appendChild(i),objectMenu.appendChild(document.createElement("br"))}objectMenu.appendChild(document.createElement("br"));const t=document.createElement("button");t.innerText="Delete",t.onclick=deleteCurrentObject,objectMenu.appendChild(t),updateMenu(e)}function generateSelect(e){const t=selectMenu.value;selectMenu.replaceChildren([]);for(const e of objectList){const t=document.createElement("option");t.innerText=e.properties.name,t.value=e.properties.name,selectMenu.appendChild(t)}selectMenu.value=e||t,e&&getObjectByName(e)&&generateMenu(getObjectByName(e))}function dragElement(e){let t=0,i=0,s=0,r=0;const n=getObjectByElementId(e.id)||{};function a(a){(a=a||window.event).preventDefault(),t=s-a.clientX,i=r-a.clientY,s=a.clientX,r=a.clientY,n.properties.x=e.offsetLeft-t,n.properties.y=e.offsetTop-i,selectMenu.value===n.properties.name&&updateMenu(n),e.style.top=e.offsetTop-i+"px",e.style.left=e.offsetLeft-t+"px"}function o(){document.onmouseup=null,document.onmousemove=null}n.dragBox&&(n.dragBox.onmousedown=function(e){n.properties.draggable&&((e=e||window.event).preventDefault(),s=e.clientX,r=e.clientY,document.onmouseup=o,document.onmousemove=a)})}function updateDimensions(e){const t=e[0].target,i=getObjectByElementId(t.id);i&&(i.properties.width=parseInt(t.style.width),i.properties.height=parseInt(t.style.height),i instanceof Text&&i.properties.scaleText&&i.properties.height>0&&(i.properties.fontSize=Math.round(i.textRatio*i.properties.height),i.properties.padding=Math.round(i.paddingRatio*i.properties.height)),i.update(),selectMenu.value===i.properties.name&&updateMenu(i))}function createObjectFromType(e,t){switch(e){case"BaseObject":return new BaseObject(t);case"Rectangle":return new Rectangle(t);case"Image":return new Image(t);case"Text":return new Text(t);case"EditableText":return new EditableText(t);case"Counter":return new Counter(t);case"CustomCounter":return new CustomCounter(t);default:return null}}function createNewObject(){let e=document.querySelector("#objectName").value;const t=document.querySelector(".warning-text");if(e=e.trim(),e)if(getObjectByName(e))t.innerText="An object already exists with that name.",t.style.display="block";else{t.style.display="none";const i=createObjectFromType(document.querySelector("#newObjectSelect").value,e);i&&(i.instantiate(),objectList.push(i),dragElement(i.HTMLElement),new ResizeObserver(updateDimensions).observe(i.HTMLElement),generateSelect(e),Odometer.init())}else t.innerText="Please enter a name.",t.style.display="block"}function objectSelected(e){if(e.target){let t=e.target;"dragbox"===e.target.className&&(t=t.parentElement);const i=getObjectByElementId(t.id);i&&(selectMenu.value=i.properties.name,generateMenu(i)),quickSelectButton.className=""}}function quickSelect(){"quickSelectActive"===quickSelectButton.className?(quickSelectButton.className="",workspace.removeEventListener("click",objectSelected,{once:!0})):(quickSelectButton.className="quickSelectActive",workspace.addEventListener("click",objectSelected,{once:!0}))}function generateJSON(){const e=objectList.map((e=>e.properties));return JSON.stringify({data:e,version:0,createdAt:Date.now()})}function exportAsJSON(){const e=document.createElement("a"),t=new Blob([generateJSON()],{type:"text/json"});e.href=URL.createObjectURL(t),e.download="export.json",e.click()}function clearWorkspace(){const e=objectList.filter((e=>e instanceof Counter));for(i=0;i<e.length;i++)clearInterval(e[i].updater);objectList=[],workspace.replaceChildren([]),objectMenu.replaceChildren([]),generateSelect("")}function importFromJSON(e,t=!1){fileImport.value="";let s=!1;if(t&&(s=confirm("Are you sure? This will overwrite your current data.")),!t||s){if(clearWorkspace(),"string"==typeof e)try{e=JSON.parse(e)}catch(e){return alert("There was an error loading your file.")}if(!e||!e.data)return alert("There was an error loading your file.");for(const t of e.data){const e=createObjectFromType(t.type,t.name);if(e){for(i=0;i<Object.keys(t).length;i++){const s=Object.keys(t)[i];"number"==typeof e.properties[s]&&isNaN(t[s])&&(t[s]=0),e.properties[s]=t[s]}e.instantiate(),objectList.push(e),dragElement(e.HTMLElement),new ResizeObserver(updateDimensions).observe(e.HTMLElement)}}generateSelect(),Odometer.init()}}function confirmReset(){confirm("Are you sure you want to reset EVERYTHING? This CANNOT be undone unless you have a backup saved!")&&clearWorkspace()}function saveInBrowser(){localStorage.setItem("lcbeta",generateJSON())}function openPopup(){document.querySelector(".popup").style.display="block"}function closePopup(){document.querySelector(".popup").style.display="none"}window.onload=()=>{selectMenu.addEventListener("input",(e=>{generateMenu(getObjectByName(e.target.value))})),fileImport.addEventListener("change",(()=>{fileImport.files[0]&&fileImport.files[0].text().then((e=>{importFromJSON(e,!0)}))}));const e=localStorage.getItem("lcbeta");e&&importFromJSON(e),localStorage.getItem("lcbeta-seenpopup")||(openPopup(),localStorage.setItem("lcbeta-seenpopup","1")),setInterval(saveInBrowser,1e4)};